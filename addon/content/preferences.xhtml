<linkset>
  <html:link rel="localization" href="__addonRef__-preferences.ftl" />
</linkset>
<groupbox
  onload="Zotero.__addonInstance__.hooks.onPrefsEvent('load', { window });"
>
  <label>
    <html:h2>XMnote Configuration</html:h2>
  </label>

  <!-- XMnote 服务器配置 -->
  <groupbox>
    <label>
      <html:h3>Server Settings</html:h3>
    </label>

    <hbox align="center">
      <html:label for="xmnote-server-ip">IP Address:</html:label>
      <html:input
        type="text"
        id="xmnote-server-ip"
        placeholder="192.168.1.100"
        style="margin-left: 10px; width: 150px"
      />
    </hbox>

    <hbox align="center" style="margin-top: 8px">
      <html:label for="xmnote-server-port">Port:</html:label>
      <html:input
        type="number"
        id="xmnote-server-port"
        placeholder="8080"
        min="1"
        max="65535"
        style="margin-left: 10px; width: 100px"
      />
    </hbox>

    <hbox align="center" style="margin-top: 8px">
      <html:label for="xmnote-server-timeout">Timeout (ms):</html:label>
      <html:input
        type="number"
        id="xmnote-server-timeout"
        placeholder="30000"
        min="1000"
        max="300000"
        style="margin-left: 10px; width: 100px"
      />
    </hbox>

    <hbox align="center" style="margin-top: 12px">
      <button id="xmnote-test-connection">Test Connection</button>
      <html:span
        id="xmnote-connection-status"
        style="font-weight: bold; margin-left: 10px"
      ></html:span>
    </hbox>
  </groupbox>

  <!-- 导入选项配置 -->
  <groupbox style="margin-top: 12px">
    <label>
      <html:h3>Import Options</html:h3>
    </label>

    <vbox>
      <checkbox
        id="xmnote-include-notes"
        label="Include Notes"
        checked="true"
      />

      <checkbox
        id="xmnote-include-annotations"
        label="Include Annotations"
        style="margin-top: 4px"
        checked="true"
      />

      <checkbox
        id="xmnote-include-metadata"
        label="Include Metadata"
        style="margin-top: 4px"
        checked="true"
      />

      <checkbox
        id="xmnote-include-current-page"
        label="Include Current Page (Smart Detection)"
        style="margin-top: 4px"
        checked="true"
      />
      <html:div
        style="margin-left: 20px; margin-top: 2px; font-size: 11px; color: #666"
      >
        ✅ Auto-skips items without totalPageCount to prevent import failures
      </html:div>

      <checkbox
        id="xmnote-include-reading-duration"
        label="Include Reading Duration Estimation"
        style="margin-top: 4px"
        checked="true"
      />

      <!-- Reading Duration Configuration -->
      <html:div style="margin-top: 12px; margin-left: 10px">
        <html:h4 style="margin: 0; color: #333; font-size: 13px">
          Reading Duration Settings
        </html:h4>
        <html:div style="font-size: 11px; color: #666; margin-bottom: 8px">
          Configure reading duration estimation parameters:
        </html:div>

        <checkbox
          id="xmnote-reading-duration-enabled"
          label="Enable Reading Duration Estimation"
          checked="true"
          style="font-size: 12px; margin-bottom: 8px"
        />

        <hbox align="center" style="margin-top: 4px">
          <html:label
            for="xmnote-reading-duration-max-session-gap"
            style="width: 200px"
          >
            Max Session Gap (seconds):
          </html:label>
          <html:input
            type="number"
            id="xmnote-reading-duration-max-session-gap"
            placeholder="1800"
            min="300"
            max="7200"
            style="margin-left: 10px; width: 80px"
          />
          <html:span style="margin-left: 5px; font-size: 11px; color: #666">
            (30 min default)
          </html:span>
        </hbox>

        <hbox align="center" style="margin-top: 4px">
          <html:label
            for="xmnote-reading-duration-min-session-duration"
            style="width: 200px"
          >
            Min Session Duration (seconds):
          </html:label>
          <html:input
            type="number"
            id="xmnote-reading-duration-min-session-duration"
            placeholder="600"
            min="60"
            max="3600"
            style="margin-left: 10px; width: 80px"
          />
          <html:span style="margin-left: 5px; font-size: 11px; color: #666">
            (10 min default)
          </html:span>
        </hbox>

        <hbox align="center" style="margin-top: 4px">
          <html:label
            for="xmnote-reading-duration-max-session-duration"
            style="width: 200px"
          >
            Max Session Duration (seconds):
          </html:label>
          <html:input
            type="number"
            id="xmnote-reading-duration-max-session-duration"
            placeholder="14400"
            min="1800"
            max="28800"
            style="margin-left: 10px; width: 80px"
          />
          <html:span style="margin-left: 5px; font-size: 11px; color: #666">
            (4 hours default)
          </html:span>
        </hbox>

        <hbox align="center" style="margin-top: 4px">
          <html:label
            for="xmnote-reading-duration-single-note-estimate"
            style="width: 200px"
          >
            Single Note Estimate (seconds):
          </html:label>
          <html:input
            type="number"
            id="xmnote-reading-duration-single-note-estimate"
            placeholder="600"
            min="60"
            max="1800"
            style="margin-left: 10px; width: 80px"
          />
          <html:span style="margin-left: 5px; font-size: 11px; color: #666">
            (10 min default)
          </html:span>
        </hbox>

        <hbox align="center" style="margin-top: 4px">
          <html:label
            for="xmnote-reading-duration-reading-speed-factor"
            style="width: 200px"
          >
            Reading Speed Factor:
          </html:label>
          <html:input
            type="number"
            id="xmnote-reading-duration-reading-speed-factor"
            placeholder="1.2"
            min="0.5"
            max="3.0"
            step="0.1"
            style="margin-left: 10px; width: 80px"
          />
          <html:span style="margin-left: 5px; font-size: 11px; color: #666">
            (1.2 default)
          </html:span>
        </hbox>
      </html:div>

      <html:div style="margin-top: 12px">
        <html:h4 style="margin: 0; color: #333; font-size: 13px"
          >Punctuation Replacement Options
        </html:h4>
        <html:div style="font-size: 11px; color: #666; margin-bottom: 8px">
          Choose which English punctuation marks to replace with Chinese
          equivalents:
        </html:div>

        <html:div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-left: 10px;
          "
        >
          <checkbox
            id="xmnote-punctuation-comma"
            label="Comma: , → ，"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-period"
            label="Period: . → 。"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-question-mark"
            label="Question: ? → ？"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-exclamation-mark"
            label="Exclamation: ! → ！"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-colon"
            label="Colon: : → ："
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-semicolon"
            label="Semicolon: ; → ；"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-parentheses"
            label="Parentheses: () → （）"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-brackets"
            label="Brackets: [] → ［］"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-braces"
            label="Braces: {} → ｛｝"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-double-quotes"
            label="Double Quotes: English → Chinese"
            checked="false"
            style="font-size: 12px"
          />
          <checkbox
            id="xmnote-punctuation-single-quotes"
            label="Single Quotes: English → Chinese"
            checked="false"
            style="font-size: 12px"
          />
        </html:div>
      </html:div>
    </vbox>

    <hbox align="center" style="margin-top: 12px">
      <html:label for="xmnote-batch-size">Batch Size:</html:label>
      <html:input
        type="number"
        id="xmnote-batch-size"
        placeholder="10"
        min="1"
        max="100"
        style="margin-left: 10px; width: 80px"
      />
    </hbox>

    <hbox align="center" style="margin-top: 8px">
      <html:label for="xmnote-retry-count">Retry Count:</html:label>
      <html:input
        type="number"
        id="xmnote-retry-count"
        placeholder="3"
        min="0"
        max="10"
        style="margin-left: 10px; width: 80px"
      />
    </hbox>
  </groupbox>

  <!-- 操作按钮 -->
  <hbox style="margin-top: 16px">
    <button id="xmnote-reset-defaults" style="margin-right: 10px">
      Reset Defaults
    </button>

    <button id="xmnote-save-config">Save Configuration</button>
  </hbox>

  <!-- 状态信息 -->
  <vbox style="margin-top: 12px">
    <html:div
      id="xmnote-config-status"
      style="padding: 8px; border-radius: 4px; display: none"
    ></html:div>
  </vbox>
</groupbox>
