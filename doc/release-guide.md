# Zotero XMnote æ’ä»¶å‘å¸ƒæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç» Zotero XMnote æ’ä»¶çš„å‘å¸ƒæµç¨‹ï¼ŒåŒ…æ‹¬ GitHub Actions è‡ªåŠ¨åŒ–å‘å¸ƒå’Œæ‰‹åŠ¨å‘å¸ƒæ“ä½œã€‚

## ğŸ”„ GitHub Actions è‡ªåŠ¨å‘å¸ƒæµç¨‹

### è§¦å‘æ¡ä»¶

å½“æ¨é€ä»¥ `v` å¼€å¤´çš„æ ‡ç­¾æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘å‘å¸ƒæµç¨‹ï¼š

```bash
git tag v1.6.0
git push origin v1.6.0
```

### è‡ªåŠ¨åŒ–æ­¥éª¤

#### 1. ç¯å¢ƒå‡†å¤‡

- è¿è¡Œç¯å¢ƒï¼š`ubuntu-latest`
- Node.js ç‰ˆæœ¬ï¼š`20`
- æƒé™ï¼š`contents: write`, `issues: write`, `pull-requests: write`

#### 2. ä»£ç æ£€å‡º

```yaml
- name: Checkout
  uses: actions/checkout@v4
  with:
    fetch-depth: 0
```

#### 3. ä¾èµ–å®‰è£…

```yaml
- name: Install deps
  run: npm install
```

#### 4. æ„å»ºæ’ä»¶

```yaml
- name: Build
  run: npm run build
```

- æ‰§è¡Œ TypeScript ç¼–è¯‘æ£€æŸ¥
- ç”Ÿæˆ `.scaffold/build/` ç›®å½•ä¸‹çš„æ„å»ºæ–‡ä»¶
- ç”Ÿæˆ `.xpi` æ’ä»¶æ–‡ä»¶

#### 5. å‘å¸ƒåˆ° GitHub

```yaml
- name: Release to GitHub
  run: |
    npm run release
    sleep 1s
```

- ä½¿ç”¨ `zotero-plugin-scaffold` å·¥å…·
- è‡ªåŠ¨åˆ›å»º GitHub Release
- ä¸Šä¼  `.xpi` æ–‡ä»¶ä½œä¸º Release èµ„äº§

#### 6. é€šçŸ¥ç›¸å…³ Issue

```yaml
- name: Notify release
  uses: apexskier/github-release-commenter@v1
```

- åœ¨ç›¸å…³ Issue ä¸­è‡ªåŠ¨è¯„è®ºå‘å¸ƒä¿¡æ¯
- åŒ…å«å‘å¸ƒæ ‡ç­¾å’Œé“¾æ¥

## ğŸ“¦ ç‰ˆæœ¬ v1.6.0 å‘å¸ƒè¯´æ˜

### ğŸ¯ ä¸»è¦æ–°åŠŸèƒ½

#### ğŸ“‚ å½“å‰åˆ†ç±»å¯¼å‡ºåŠŸèƒ½

- **æ–°å¢**ï¼šå½“å‰åˆ†ç±»å¯¼å‡ºé€‰é¡¹ï¼Œæ”¯æŒå¯¼å‡ºå½“å‰é€‰ä¸­åˆ†ç±»ä¸‹çš„æ‰€æœ‰æ¡ç›®
- **æ™ºèƒ½é»˜è®¤é€‰æ‹©**ï¼šæ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å¯¼å‡ºèŒƒå›´
    - ä¼˜å…ˆçº§ï¼šé€‰ä¸­æ¡ç›® > å½“å‰åˆ†ç±» > å…¨éƒ¨æ¡ç›®
- **åŠ¨æ€ç•Œé¢æ›´æ–°**ï¼šå¯¼å‡ºæè¿°æ–‡å­—å®æ—¶æ›´æ–°ï¼Œæ¸…æ¥šæ˜¾ç¤ºå°†è¦å¯¼å‡ºçš„å†…å®¹

#### ğŸ”§ æŠ€æœ¯æ”¹è¿›

- **æ‰©å±•å¯¹è¯æ¡†æ¶æ„**ï¼šåˆ›å»º `ExtendedExportDialog` ç±»ï¼Œä¿æŒå‘åå…¼å®¹
- **åˆ†ç±»æ£€æµ‹ API**ï¼šé›†æˆ Zotero åˆ†ç±»æ£€æµ‹åŠŸèƒ½
- **ç±»å‹ç³»ç»Ÿå¢å¼º**ï¼šæ”¯æŒ "collection" å¯¼å‡ºèŒƒå›´çš„ç±»å‹å®šä¹‰

### ğŸ›ï¸ å¯¼å‡ºé€‰é¡¹è¯´æ˜

| é€‰é¡¹       | æè¿°             | ä¼˜å…ˆçº§ |
|----------|----------------|-----|
| **é€‰å®šæ¡ç›®** | å¯¼å‡ºå½“å‰é€‰ä¸­çš„æ¡ç›®      | æœ€é«˜  |
| **å½“å‰åˆ†ç±»** | å¯¼å‡ºå½“å‰é€‰ä¸­åˆ†ç±»ä¸‹çš„æ‰€æœ‰æ¡ç›® | ç¬¬äºŒ  |
| **å…¨éƒ¨æ¡ç›®** | å¯¼å‡ºå›¾ä¹¦é¦†ä¸­çš„æ‰€æœ‰æ¡ç›®    | é»˜è®¤  |

### ğŸ”„ ç”¨æˆ·ä½“éªŒæ”¹è¿›

- **æ™ºèƒ½ç•Œé¢**ï¼šå¯¹è¯æ¡†æ ¹æ®å½“å‰ä¸Šä¸‹æ–‡è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„é»˜è®¤é€‰é¡¹
- **å®æ—¶åé¦ˆ**ï¼šæè¿°æ–‡å­—åŠ¨æ€æ›´æ–°ï¼Œæ˜¾ç¤ºå°†è¦å¯¼å‡ºçš„å†…å®¹æ•°é‡
- **æ— ç¼é›†æˆ**ï¼šä¸ç°æœ‰å·¥ä½œæµç¨‹å®Œå…¨å…¼å®¹

### ğŸ› ï¸ å¼€å‘è€…æ›´æ–°

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ–°å¢ `exportDialogExtended.ts` æ¨¡å—
- **äº‹ä»¶å¤„ç†ä¼˜åŒ–**ï¼šæ”¹è¿› DOM äº‹ä»¶ç›‘å¬å’Œæ›´æ–°æœºåˆ¶
- **é”™è¯¯å¤„ç†å¢å¼º**ï¼šæ·»åŠ æ›´å¥½çš„ç±»å‹å®‰å…¨å’Œé”™è¯¯æ•è·

## ğŸš€ æ‰‹åŠ¨å‘å¸ƒæ“ä½œæŒ‡å—

### å‰ç½®æ¡ä»¶

1. ç¡®ä¿ä»£ç å·²æäº¤åˆ°ä¸»åˆ†æ”¯
2. æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·
3. æµ‹è¯•æ„å»ºæ— é”™è¯¯ï¼š`npm run build`
4. é€šè¿‡ä»£ç è´¨é‡æ£€æŸ¥ï¼š`npm run lint:check`

### å‘å¸ƒæ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Git æ ‡ç­¾ï¼ˆæ¨èï¼‰

```bash
# 1. ç¡®ä¿åœ¨ä¸»åˆ†æ”¯
git checkout main
git pull origin main

# 2. åˆ›å»ºæ ‡ç­¾
git tag v1.6.0

# 3. æ¨é€æ ‡ç­¾è§¦å‘è‡ªåŠ¨å‘å¸ƒ
git push origin v1.6.0

# 4. ç­‰å¾… GitHub Actions å®Œæˆ
# æŸ¥çœ‹è¿›åº¦ï¼šhttps://github.com/Zonezzc/zotero-xmnote/actions
```

#### æ–¹æ³•äºŒï¼šæœ¬åœ°æ„å»ºåæ‰‹åŠ¨ä¸Šä¼ 

```bash
# 1. æœ¬åœ°æ„å»º
npm run build

# 2. æ‰‹åŠ¨åˆ›å»º GitHub Release
gh release create v1.6.0 \
  --title "v1.6.0: å½“å‰åˆ†ç±»å¯¼å‡ºä¸æ™ºèƒ½é€‰æ‹©åŠŸèƒ½" \
  --notes-file doc/release/v1.6.0-release-notes.md \
  .scaffold/build/zotero-xmnote-plugin.xpi
```

### éªŒè¯å‘å¸ƒ

1. æ£€æŸ¥ [GitHub Releases é¡µé¢](https://github.com/Zonezzc/zotero-xmnote/releases)
2. ç¡®è®¤ `.xpi` æ–‡ä»¶å·²ä¸Šä¼ 
3. æµ‹è¯•ä¸‹è½½å’Œå®‰è£…

## ğŸ“ å‘å¸ƒæ³¨æ„äº‹é¡¹

### ç‰ˆæœ¬å‘½åè§„èŒƒ

- éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼š`MAJOR.MINOR.PATCH`
- æ ‡ç­¾æ ¼å¼ï¼š`v1.6.0`
- å‘å¸ƒæ ‡é¢˜ï¼šåŒ…å«ç‰ˆæœ¬å·å’Œä¸»è¦åŠŸèƒ½

### å‘å¸ƒè¯´æ˜å†…å®¹

- **ä¸»è¦åŠŸèƒ½**ï¼šåˆ—å‡ºæ–°å¢çš„é‡è¦åŠŸèƒ½
- **æ”¹è¿›é¡¹ç›®**ï¼šæ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›
- **ä¿®å¤é—®é¢˜**ï¼šè§£å†³çš„ Bug å’Œé—®é¢˜
- **æŠ€æœ¯ç»†èŠ‚**ï¼šå¼€å‘è€…å…³å¿ƒçš„æŠ€æœ¯æ›´æ–°
- **å®‰è£…æŒ‡å—**ï¼šç”¨æˆ·å®‰è£…å’Œä½¿ç”¨è¯´æ˜

### å¸¸è§é—®é¢˜

#### Q: GitHub Actions å‘å¸ƒå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. `package.json` ç‰ˆæœ¬å·æ˜¯å¦æ›´æ–°
2. æ„å»ºæ˜¯å¦é€šè¿‡ï¼š`npm run build`
3. ä»£ç æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼š`npm run lint:check`
4. GitHub Token æƒé™æ˜¯å¦æ­£ç¡®

#### Q: å¦‚ä½•æ›´æ–°å·²å‘å¸ƒç‰ˆæœ¬çš„è¯´æ˜ï¼Ÿ

A: æœ‰å‡ ç§æ–¹æ³•ï¼š

**æ–¹æ³•1ï¼šGitHub ç½‘é¡µç•Œé¢**

1. è®¿é—® [GitHub Releases é¡µé¢](https://github.com/Zonezzc/zotero-xmnote/releases)
2. æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬ï¼Œç‚¹å‡» "Edit release"
3. ä¿®æ”¹å‘å¸ƒè¯´æ˜åä¿å­˜

**æ–¹æ³•2ï¼šå‘½ä»¤è¡Œå·¥å…·**

```bash
# ä½¿ç”¨æ–‡ä»¶è¦†ç›–å‘å¸ƒè¯´æ˜
gh release edit v1.6.0 --notes-file doc/release/v1.6.0-release-notes.md

# æˆ–è€…ç›´æ¥ç¼–è¾‘
gh release edit v1.6.0 --notes "æ–°çš„å‘å¸ƒè¯´æ˜å†…å®¹"
```

#### Q: è¦†ç›–å‘å¸ƒè¯´æ˜åå¦‚ä½•æ¢å¤ï¼Ÿ

A: GitHub ä¸ä¿å­˜å‘å¸ƒè¯´æ˜çš„å†å²ç‰ˆæœ¬ï¼Œä½†ä½ å¯ä»¥ï¼š

**æ¢å¤æ–¹æ³•ï¼š**

1. **ä»å¤‡ä»½æ¢å¤**ï¼šä½¿ç”¨ `doc/release/` ç›®å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶
2. **ä» Git å†å²æ¢å¤**ï¼šå¦‚æœå‘å¸ƒè¯´æ˜æ›¾ç»æäº¤åˆ°ä»£ç åº“
3. **é‡æ–°ç”Ÿæˆ**ï¼šä½¿ç”¨ `zotero-plugin release` å‘½ä»¤é‡æ–°ç”ŸæˆåŸºç¡€è¯´æ˜

**é¢„é˜²æªæ–½ï¼š**

- åœ¨ `doc/release/` ç›®å½•ä¿ç•™å‘å¸ƒè¯´æ˜çš„å¤‡ä»½
- é‡è¦ä¿®æ”¹å‰å…ˆå¤‡ä»½å½“å‰è¯´æ˜ï¼š

```bash
# å¤‡ä»½å½“å‰å‘å¸ƒè¯´æ˜
gh release view v1.6.0 --json body -q .body > doc/release/v1.6.0-backup.md
```

#### Q: å¦‚ä½•åˆ é™¤é”™è¯¯çš„å‘å¸ƒï¼Ÿ

A: ä½¿ç”¨ GitHub CLIï¼š

```bash
gh release delete v1.6.0 --yes
git tag -d v1.6.0
git push origin :refs/tags/v1.6.0
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub Actions å·¥ä½œæµ](../.github/workflows/release.yml)
- [é¡¹ç›®å‘å¸ƒé¡µé¢](https://github.com/Zonezzc/zotero-xmnote/releases)
- [Zotero Plugin Scaffold æ–‡æ¡£](https://github.com/windingwind/zotero-plugin-scaffold)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥ [GitHub Actions æ—¥å¿—](https://github.com/Zonezzc/zotero-xmnote/actions)
2. å‚è€ƒæœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
3. åœ¨ [GitHub Issues](https://github.com/Zonezzc/zotero-xmnote/issues) ä¸­æŠ¥å‘Šé—®é¢˜

---

**æœ€åæ›´æ–°**ï¼š2025-08-21  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**é€‚ç”¨æ’ä»¶ç‰ˆæœ¬**ï¼šv1.6.0+